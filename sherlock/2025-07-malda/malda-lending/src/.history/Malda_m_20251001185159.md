
## intro
Malda is a Unified Liquidity Lending protocol on Ethereum and Layer 2s, delivering a seamless lending experience through **global liquidity pools**. 
enhanced with **cross-chain capabilities using zk-coprocessor proofs** (Risc0) and **extension gateways** for remote execution.

## Host & Extension

The mTokenGateway contract serves as a gateway for handling token operations similar to the mErc20Host contract. It’s the extensions (not Linea) chains’ equivalent of a market.

mTokenHost：资金真实存放地，处理完整的借贷逻辑（mint、redeem、borrow、repay、liquidate）。
mTokenGateway：只做“入口”，不保存资金，只记录存取款并生成跨链证明。

* **Host (Linea)** = 银行总部（唯一账本、唯一资金池）
* **Extension (Arbitrum / Optimism)** = 银行分行（只是存取款窗口）
* **Gateway** = 分行柜台

  * 你可以存钱（mint和repay）
  * 可以取钱（redeem和borrow），但必须去总部（Host）登记

## Everclear 桥的工作机制

 **Everclear 桥的工作机制** 跟你常见的点对点桥（锁仓-释放）不太一样，更像是 **意图 + 做市商（LP）撮合** 的跨链系统。

---

### 什么是 Everclear 的 Intent?

* 用户/协议不是直接说“我要从链 A → 链 B 转资产”。
* 而是向 Everclear 注册一个 **Intent**（意图），里面写明：

  * 我愿意提供多少资产（inputAsset, amount）
  * 我期望得到的资产（outputAsset）
  * 我允许的目的地链（destinations[]）
  * 以及手续费/ttl 等参数。

所以 Intent 本质上是一个 **跨链订单**。

---

### fulfill 是什么？

* Intent 本身不会自动完成，需要有 **流动性提供者（LP）/ relayer** 来 **fulfill**。
* fulfill 的意思就是：

  * LP 在目标链（比如 Arbitrum）**先行支付**给用户/合约（比如发 100 USDC 给目标地址）。
  * 然后 LP 到源链的 Everclear 领取用户原本锁进来的资金（+ 手续费）。

这样用户就不用等慢链桥确认，跨链速度取决于 LP 的履约。

---

### 为什么多个目的地有问题？

如果 Intent 中 `destinations = [Arbitrum, Avalanche]`：

* Everclear 系统会把这条 intent 注册为 “用户愿意在 **Arbitrum 或 Avalanche** 其中一个链收款”。
* 那么 LP **有权选择**在哪个链 fulfill。

  * 如果有个 LP 觉得在 Avalanche 上 fulfill 更划算，就会把资产发到 Avalanche。

**结果**：资金就流到 Avalanche 了。
但 Malda 协议根本没在 Avalanche 上部署合约 → 资金“到站了”，但是没人接收，等于丢了。

---

### 对比一个正确的例子

* Malda 的 Rebalancer 其实只想把钱跨到 Arbitrum。
* 安全做法是：

  ```
  destinations = [Arbitrum]
  ```
* 这样 Everclear intent 就只能在 Arbitrum fulfill，LP 没有选择空间。



