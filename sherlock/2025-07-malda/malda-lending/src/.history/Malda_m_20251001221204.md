
## intro
Malda is a Unified Liquidity Lending protocol on Ethereum and Layer 2s, delivering a seamless lending experience through **global liquidity pools**. 
enhanced with **cross-chain capabilities using zk-coprocessor proofs** (Risc0) and **extension gateways** for remote execution.

## Host & Extension

The mTokenGateway contract serves as a gateway for handling token operations similar to the mErc20Host contract. It’s the extensions (not Linea) chains’ equivalent of a market.

mTokenHost：资金真实存放地，处理完整的借贷逻辑（mint、redeem、borrow、repay、liquidate）。
mTokenGateway：只做“入口”，不保存资金，只记录存取款并生成跨链证明。

* **Host (Linea)** = 银行总部（唯一账本、唯一资金池）
* **Extension (Arbitrum / Optimism)** = 银行分行（只是存取款窗口）
* **Gateway** = 分行柜台

  * 你可以存钱（mint和repay）
  * 可以取钱（redeem和borrow），但必须去总部（Host）登记

## Everclear 桥的工作机制 (Intent & fulfill & destinations)

 **Everclear 桥的工作机制** 跟你常见的点对点桥（锁仓-释放）不太一样，更像是 **意图 + 做市商（LP）撮合** 的跨链系统。

---

### 什么是 Everclear 的 Intent?

* 用户/协议不是直接说“我要从链 A → 链 B 转资产”。
* 而是向 Everclear 注册一个 **Intent**（意图），里面写明：

  * 我愿意提供多少资产（inputAsset, amount）
  * 我期望得到的资产（outputAsset）
  * 我允许的目的地链（destinations[]）
  * 以及手续费/ttl 等参数。

所以 Intent 本质上是一个 **跨链订单**。

---

### fulfill 是什么？

* Intent 本身不会自动完成，需要有 **流动性提供者（LP）/ relayer** 来 **fulfill**。
* fulfill 的意思就是：

  * LP 在目标链（比如 Arbitrum）**先行支付**给用户/合约（比如发 100 USDC 给目标地址）。
  * 然后 LP 到源链的 Everclear 领取用户原本锁进来的资金（+ 手续费）。

这样用户就不用等慢链桥确认，跨链速度取决于 LP 的履约。

---

### 为什么多个目的地有问题？

如果 Intent 中 `destinations = [Arbitrum, Avalanche]`：

* Everclear 系统会把这条 intent 注册为 “用户愿意在 **Arbitrum 或 Avalanche** 其中一个链收款”。
* 那么 LP **有权选择**在哪个链 fulfill。

  * 如果有个 LP 觉得在 Avalanche 上 fulfill 更划算，就会把资产发到 Avalanche。

**结果**：资金就流到 Avalanche 了。
但 Malda 协议根本没在 Avalanche 上部署合约 → 资金“到站了”，但是没人接收，等于丢了。

---

### 对比一个正确的例子

* Malda 的 Rebalancer 其实只想把钱跨到 Arbitrum。
* 安全做法是：

  ```
  destinations = [Arbitrum]
  ```
* 这样 Everclear intent 就只能在 Arbitrum fulfill，LP 没有选择空间。


好的 👍，我来帮你把 **Everclear 两条路径的背景**完整梳理一下，这其实是理解 **Issue M-10** 的关键。

---

## Everclear 背景 (Netting Pathway & Solver Pathway)

Everclear 是 **Across Protocol** 推出的一个跨链结算层，用来做 **Intent Settlement（意图结算）**。
设计目标是：

* **普通用户**：通过 “intent + solver” 模式获得跨链服务。
* **专业参与者（比如 rebalancers）**：通过 “netting” 模式进行流动性再平衡。

所以它有 **两条路径**：

---

## ① Netting Pathway （净额结算路径）

👉 专门给 **rebalancers（流动性再平衡者）** 用的。

**特点：**

* **maxFee == 0**

  * 表示没有 solver fee。
  * 因为不是通过 solver 执行，而是 hub 直接处理。

* **ttl == 0**

  * 表示没有过期时间，hub 在收到 intent 后立即处理。

* **撮合方式**

  * hub 直接把跨链需求对冲掉（netting），比如：

    * Rebalancer A 想把 USDC 从 Arbitrum → Optimism。
    * Rebalancer B 想把 USDC 从 Optimism → Arbitrum。
    * Hub 直接撮合二者，链下记账，链上结算。

**优势：**

* **低成本**（没有 solver 提成）。
* **快速确定性**（hub 立即撮合，无需等待 solver 竞价）。
* **适合 rebalancer 高频操作**（避免因费用过高导致不可持续）。

---

## ② Solver Pathway （解算器路径）

👉 面向 **普通用户**（想要跨链转账 / swap 的个人）。

**特点：**

* **maxFee > 0**

  * 用户设定自己愿意支付的最大手续费。

* **ttl > 0**

  * 意图有一个过期时间，solver 必须在有效期内执行。

* **执行方式**

  * 意图会进入 **solver 市场**。
  * Solver（解算器）看到 intent 后，出资预先完成跨链操作，然后从用户处收取代币 + fee。

**优势：**

* **去中心化**：任何 solver 都可以参与。
* **灵活性**：支持多种资产和复杂跨链操作。

**代价：**

* 成本更高（solver 收取费用）。
* 速度可能受市场和 solver 激励影响。

---

## 为什么 **Rebalancer 只能走 Netting Pathway**

* Rebalancer 的职责是维持 **市场间的流动性平衡**，比如把多余的资金从一个链调到另一个链。
* 这通常是 **大额 + 高频** 的操作，如果每次都要走 solver pathway：

  * 成本会极高（fee 可能 5–10 倍于 netting）。
  * 而且还依赖 solver 的意愿和效率。
* 因此 Everclear 在文档里 **明确要求**：

  * Rebalancer **必须走 netting pathway**
  * 即 `maxFee == 0` 且 `ttl == 0`。

---

✅ **一句话背景总结**：
Everclear 有两条路径：**netting pathway（无 fee，立即结算，专供 rebalancers）** 和 **solver pathway（带 fee，由 solver 处理，面向用户）**。M-10 的问题在于代码没强制要求 rebalancer intent 只能走 netting pathway，导致可能被错误送入 solver pathway，造成失败或高额成本。


